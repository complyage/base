package verify

//||------------------------------------------------------------------------------------------------||
//|| Import
//||------------------------------------------------------------------------------------------------||

import (
	"time"

	"github.com/google/uuid"
	"github.com/ralphferrara/aria/db"
	"github.com/ralphferrara/aria/storage"
)

//||------------------------------------------------------------------------------------------------||
//|| Create a Verification
//||------------------------------------------------------------------------------------------------||

func Create(dataType DataType, fidAccount int64, s *storage.Storage, d *db.GormWrapper, privateKey string, publicKey string) (Verification, error) {
	LogInfo("Verify: Init Verification")
	//||------------------------------------------------------------------------------------------------||
	//|| Start a Verification
	//||------------------------------------------------------------------------------------------------||
	vUUID := uuid.NewString()
	//||------------------------------------------------------------------------------------------------||
	//|| Create a Verification
	//||------------------------------------------------------------------------------------------------||
	verification := Verification{
		FidAccount: fidAccount,
		Keys: PrivatePublic{
			Private: privateKey,
			Public:  publicKey,
		},
		CanReset:      false,
		ResetAttempts: 0,
		Status:        STATUSES.Pending,
		UUID:          vUUID,
		Type:          dataType,
		Timestamp:     time.Now().UTC(),
		Storage:       *s,
		Database:      d,
	}
	//||------------------------------------------------------------------------------------------------||
	//|| Updated
	//||------------------------------------------------------------------------------------------------||
	verification.Updated()
	//||------------------------------------------------------------------------------------------------||
	//|| Steps
	//||------------------------------------------------------------------------------------------------||
	verification.StepsInit()
	//||------------------------------------------------------------------------------------------------||
	//|| Create a Verification
	//||------------------------------------------------------------------------------------------------||
	verification.TwoFactorInit()
	//||------------------------------------------------------------------------------------------------||
	//|| Create the Public Transaction
	//||------------------------------------------------------------------------------------------------||
	verification.TransactionPublicInit()
	//||------------------------------------------------------------------------------------------------||
	//|| Create the Encrypted Data
	//||------------------------------------------------------------------------------------------------||
	verification.EncryptedInit()
	//||------------------------------------------------------------------------------------------------||
	//|| Create a Verification
	//||------------------------------------------------------------------------------------------------||
	verification.DatabaseSaveInsert()
	verification.Save()
	//||------------------------------------------------------------------------------------------------||
	//|| Create a Verification
	//||------------------------------------------------------------------------------------------------||
	return verification, nil
}
