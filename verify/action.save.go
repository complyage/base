package verify

import (
	"encoding/json"

	"github.com/ralphferrara/aria/app"
)

//||------------------------------------------------------------------------------------------------||
//|| Save: persist a Verification to storage as <uuid>.json
//||------------------------------------------------------------------------------------------------||

func (v *Verification) Save() error {
	//||------------------------------------------------------------------------------------------------||
	//|| Validate
	//||------------------------------------------------------------------------------------------------||
	if v == nil {
		return app.Err("Verify").Error("NIL_VERIFICATION")
	}
	//||------------------------------------------------------------------------------------------------||
	//|| Touch updated timestamp
	//||------------------------------------------------------------------------------------------------||
	v.Updated()
	//||------------------------------------------------------------------------------------------------||
	//|| Serialize
	//||------------------------------------------------------------------------------------------------||
	data, mErr := json.MarshalIndent(v, "", "  ")
	if mErr != nil {
		app.Log.Error("Verification Marshal Error:", mErr)
		return app.Err("Verify").Error("VERIFY_SAVE_MARSHAL")
	}
	//||------------------------------------------------------------------------------------------------||
	//|| Store
	//||------------------------------------------------------------------------------------------------||
	err := Storage.Put(v.Filename(), data)
	if err != nil {
		return app.Err("Verify").Error("VERIFY_SAVE_PUT")
	}
	//||------------------------------------------------------------------------------------------------||
	//|| Saved
	//||------------------------------------------------------------------------------------------------||
	app.Log.Data("Saved Verification:", v.Filename())
	//||------------------------------------------------------------------------------------------------||
	//|| Done
	//||------------------------------------------------------------------------------------------------||
	return nil
}
