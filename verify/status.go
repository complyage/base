package verify

import "github.com/ralphferrara/aria/app"

//||------------------------------------------------------------------------------------------------||
//|| Pending Verification
//||------------------------------------------------------------------------------------------------||

func (v *Verification) UpdateStatusPendingVerification() error {
	LogInfo("Verify: Pending Verification")
	//||------------------------------------------------------------------------------------------------||
	//|| Set Status
	//||------------------------------------------------------------------------------------------------||
	v.Status = StatusPendingVerification
	v.Updated()
	//||------------------------------------------------------------------------------------------------||
	//|| Add Step
	//||------------------------------------------------------------------------------------------------||
	v.AddStep(app.Constants("VERIFY_STEP_TYPES").Get("STATUS_PEVF"), "")
	//||------------------------------------------------------------------------------------------------||
	//|| Save
	//||------------------------------------------------------------------------------------------------||
	v.Save()
	v.DatabaseUpdate()
	//||------------------------------------------------------------------------------------------------||
	//|| Done
	//||------------------------------------------------------------------------------------------------||
	return nil
}

//||------------------------------------------------------------------------------------------------||
//|| In Progress
//||------------------------------------------------------------------------------------------------||

func (v *Verification) UpdateStatusInProgress() error {
	LogInfo("Verify: In Progress")
	//||------------------------------------------------------------------------------------------------||
	//|| Set Status
	//||------------------------------------------------------------------------------------------------||
	v.Status = StatusInProgress
	v.Updated()
	//||------------------------------------------------------------------------------------------------||
	//|| Add Step
	//||------------------------------------------------------------------------------------------------||
	v.AddStep(app.Constants("VERIFY_STEP_TYPES").Get("STATUS_INPR"), "")
	//||------------------------------------------------------------------------------------------------||
	//|| Save
	//||------------------------------------------------------------------------------------------------||
	v.Save()
	v.DatabaseUpdate()
	//||------------------------------------------------------------------------------------------------||
	//|| Done
	//||------------------------------------------------------------------------------------------------||
	return nil
}

//||------------------------------------------------------------------------------------------------||
//|| Escalate
//||------------------------------------------------------------------------------------------------||

func (v *Verification) UpdateStatusEscalate() error {
	//||------------------------------------------------------------------------------------------------||
	//|| Set Status
	//||------------------------------------------------------------------------------------------------||
	v.Status = StatusEscalated
	v.Level = v.Level + 1
	v.Updated()
	//||------------------------------------------------------------------------------------------------||
	//|| Add Step
	//||------------------------------------------------------------------------------------------------||
	v.AddStep(app.Constants("VERIFY_STEP_TYPES").Get("STATUS_ESCL"), "")
	//||------------------------------------------------------------------------------------------------||
	//|| Save
	//||------------------------------------------------------------------------------------------------||
	v.Save()
	//||------------------------------------------------------------------------------------------------||
	//|| Done
	//||------------------------------------------------------------------------------------------------||
	return nil
}

//||------------------------------------------------------------------------------------------------||
//|| Escalate
//||------------------------------------------------------------------------------------------------||

func (v *Verification) UpdateStatusVerified(moderator string) error {
	LogInfo("Update Status Verify: Verified")
	//||------------------------------------------------------------------------------------------------||
	//|| Set Status
	//||------------------------------------------------------------------------------------------------||
	v.Status = StatusVerified
	v.Updated()
	//||------------------------------------------------------------------------------------------------||
	//|| Add Moderate Info
	//||------------------------------------------------------------------------------------------------||
	v.Moderate = Moderate{
		Status:    "APPROVED",
		Moderator: moderator,
		Timestamp: UniversalNow().String(),
	}
	//||------------------------------------------------------------------------------------------------||
	//|| Two Factor Approved
	//||------------------------------------------------------------------------------------------------||
	v.AddStep(app.Constants("VERIFY_STEP_TYPES").Get("APPROVAL"), moderator)
	//||------------------------------------------------------------------------------------------------||
	//|| Add Step
	//||------------------------------------------------------------------------------------------------||
	v.AddStep(app.Constants("VERIFY_STEP_TYPES").Get("STATUS_VERF"), "")
	//||------------------------------------------------------------------------------------------------||
	//|| Lock the Encrypted Data
	//||------------------------------------------------------------------------------------------------||
	v.Identity.SetVerification(v.Type.String(), true, v.Encrypted.GetDataMasked(), v.UUID)
	//||------------------------------------------------------------------------------------------------||
	//|| Lock the Encrypted Data and Update the Database / Storage
	//||------------------------------------------------------------------------------------------------||
	//v.SaveEncrypted()
	v.Save()
	v.DatabaseUpdate()
	//||------------------------------------------------------------------------------------------------||
	//|| Done
	//||------------------------------------------------------------------------------------------------||
	return nil
}

//||------------------------------------------------------------------------------------------------||
//|| Escalate
//||------------------------------------------------------------------------------------------------||

func (v *Verification) UpdateStatusReject(moderator string, reason app.ErrorsEntry) error {
	//||------------------------------------------------------------------------------------------------||
	//|| Set Status
	//||------------------------------------------------------------------------------------------------||
	v.Status = StatusRejected
	v.Updated()
	//||------------------------------------------------------------------------------------------------||
	//|| Add Moderate Info
	//||------------------------------------------------------------------------------------------------||
	v.Moderate = Moderate{
		Status:    "REJECTED",
		Moderator: moderator,
		Timestamp: UniversalNow().String(),
		Details:   reason.Code,
	}
	//||------------------------------------------------------------------------------------------------||
	//|| Add Step
	//||------------------------------------------------------------------------------------------------||
	v.AddStep(app.Constants("VERIFY_STEP_TYPES").Get("STATUS_RJCT"), reason.Code)
	//||------------------------------------------------------------------------------------------------||
	//|| Testing
	//||------------------------------------------------------------------------------------------------||
	//||------------------------------------------------------------------------------------------------||
	//|| Save
	//||------------------------------------------------------------------------------------------------||
	v.Save()
	v.DatabaseUpdate()
	//||------------------------------------------------------------------------------------------------||
	//|| Save
	//||------------------------------------------------------------------------------------------------||
	//v.Lock()
	//||------------------------------------------------------------------------------------------------||
	//|| Remove the Data
	//||------------------------------------------------------------------------------------------------||
	//v.DeleteEncrypted()
	//||------------------------------------------------------------------------------------------------||
	//|| Done
	//||------------------------------------------------------------------------------------------------||
	return nil
}

//||------------------------------------------------------------------------------------------------||
//|| Escalate
//||------------------------------------------------------------------------------------------------||

func (v *Verification) UpdateStatusExpired() error {
	//||------------------------------------------------------------------------------------------------||
	//|| Set Status
	//||------------------------------------------------------------------------------------------------||
	v.Status = StatusVerified
	v.Updated()
	//||------------------------------------------------------------------------------------------------||
	//|| Add Step
	//||------------------------------------------------------------------------------------------------||
	v.AddStep(app.Constants("VERIFY_STEP_TYPES").Get("STATUS_EXPD"), "")
	//||------------------------------------------------------------------------------------------------||
	//|| Save
	//||------------------------------------------------------------------------------------------------||
	v.Save()
	//||------------------------------------------------------------------------------------------------||
	//|| Remove the Data
	//||------------------------------------------------------------------------------------------------||
	v.DeleteEncrypted()
	//||------------------------------------------------------------------------------------------------||
	//|| Done
	//||------------------------------------------------------------------------------------------------||
	return nil
}
