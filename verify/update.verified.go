package verify

import (
	"time"

	"github.com/ralphferrara/aria/app"
)

//||------------------------------------------------------------------------------------------------||
//|| Escalate
//||------------------------------------------------------------------------------------------------||

func (v *Verification) UpdateStatusVerified(moderator string) error {
	app.Log.Info("Verification Status : Verified - ", v.UUID)
	//||------------------------------------------------------------------------------------------------||
	//|| Set Status
	//||------------------------------------------------------------------------------------------------||
	v.Status = StatusVerified
	//||------------------------------------------------------------------------------------------------||
	//|| Add Moderate Info
	//||------------------------------------------------------------------------------------------------||
	v.Moderate = Moderate{
		Status:    app.Constants("MODERATE_TYPES").Code("TwoFactor"),
		Moderator: moderator,
		Timestamp: time.Now().UTC(),
	}
	//||------------------------------------------------------------------------------------------------||
	//|| Two Factor Approved
	//||------------------------------------------------------------------------------------------------||
	v.AddStep(app.Constants("VERIFY_STEP_TYPES").Get("APPROVAL"), moderator)
	//||------------------------------------------------------------------------------------------------||
	//|| Add Step
	//||------------------------------------------------------------------------------------------------||
	v.AddStep(app.Constants("VERIFY_STEP_TYPES").Get("STATUS_VERF"), "")
	//||------------------------------------------------------------------------------------------------||
	//|| Lock the Encrypted Data and Update the Database / Storage
	//||------------------------------------------------------------------------------------------------||
	v.Finalize(true)
	v.DatabaseUpdate()
	//||------------------------------------------------------------------------------------------------||
	//|| Done
	//||------------------------------------------------------------------------------------------------||
	return nil
}
