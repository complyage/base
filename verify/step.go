package verify

import "github.com/ralphferrara/aria/app"

//||------------------------------------------------------------------------------------------------||
//|| Main Type Export
//||------------------------------------------------------------------------------------------------||

type Step struct {
	Type      app.ConstantsEntry `json:"type"`
	Timestamp UniversalDate      `json:"timestamp"`
	Details   string             `json:"details,omitempty"`
}

//||------------------------------------------------------------------------------------------------||
//|| Initialize Steps
//||------------------------------------------------------------------------------------------------||

func (v *Verification) StepsInit() {
	//||------------------------------------------------------------------------------------------------||
	//|| Initialize Steps
	//||------------------------------------------------------------------------------------------------||
	v.Step = 0
	v.Steps = make([]Step, 0)
	//||------------------------------------------------------------------------------------------------||
	//|| Add Initial Step
	//||------------------------------------------------------------------------------------------------||
	v.AddStep(app.Constants("VERIFY_STEP_TYPES").Get("INITIAL"), "")
}

//||------------------------------------------------------------------------------------------------||
//|| Add Step
//||------------------------------------------------------------------------------------------------||

func (v *Verification) AddStep(stepType app.ConstantsEntry, details string) {
	//||------------------------------------------------------------------------------------------------||
	//|| Create Step
	//||------------------------------------------------------------------------------------------------||
	step := Step{
		Type:      stepType,
		Timestamp: UniversalNow(),
		Details:   details,
	}
	//||------------------------------------------------------------------------------------------------||
	//|| Append Step
	//||------------------------------------------------------------------------------------------------||
	v.Steps = append(v.Steps, step)
	v.Updated()
}

//||------------------------------------------------------------------------------------------------||
//|| Increment Step
//||------------------------------------------------------------------------------------------------||

func (v *Verification) IncrementStep() {
	//||------------------------------------------------------------------------------------------------||
	//|| Increment Step
	//||------------------------------------------------------------------------------------------------||
	v.Step = v.Step + 1
	v.Updated()
	v.Save()
}

//||------------------------------------------------------------------------------------------------||
//|| Count Steps of Type
//||------------------------------------------------------------------------------------------------||

func (v *Verification) CountStepsOfType(stepType app.ConstantsEntry) int {
	count := 0
	for _, step := range v.Steps {
		if step.Type.Name == stepType.Name {
			count++
		}
	}
	return count
}
