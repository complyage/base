package verify

import (
	"time"

	"github.com/ralphferrara/aria/app"
)

//||------------------------------------------------------------------------------------------------||
//|| Escalate
//||------------------------------------------------------------------------------------------------||

func (v *Verification) UpdateStatusReject(moderator string, reason app.ErrorsEntry) error {
	app.Log.Info("Verification Status : Rejected - ", v.UUID)
	//||------------------------------------------------------------------------------------------------||
	//|| Set Status
	//||------------------------------------------------------------------------------------------------||
	v.Status = StatusRejected
	//||------------------------------------------------------------------------------------------------||
	//|| Add Moderate Info
	//||------------------------------------------------------------------------------------------------||
	v.Moderate = Moderate{
		Status:    app.Constants("MODERATE_TYPES").Code("TwoFactor"),
		Moderator: moderator,
		Timestamp: time.Now().UTC(),
		Details:   reason.Code,
	}
	//||------------------------------------------------------------------------------------------------||
	//|| Two Factor Approved
	//||------------------------------------------------------------------------------------------------||
	v.AddStep(app.Constants("VERIFY_STEP_TYPES").Get("STATUS_RJCT"), reason.Code)
	//||------------------------------------------------------------------------------------------------||
	//|| Lock the Encrypted Data and Update the Database / Storage
	//||------------------------------------------------------------------------------------------------||
	v.Finalize(false)
	v.DatabaseUpdate()
	//||------------------------------------------------------------------------------------------------||
	//|| Done
	//||------------------------------------------------------------------------------------------------||
	return nil
}
